generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Venda {
  id        Int      @id @default(autoincrement())
  data      DateTime @default(now())
  total     Decimal
  entrega         Boolean  @default(false)       // É pra entregar?
  statusEntrega   String?  @default("PENDENTE")  // "PENDENTE" ou "ENTREGUE"
  enderecoEntrega String?                        // Onde entregar?
  
  // formaPagamento String? (Pode apagar ou deixar como opcional, não vamos mais usar ele como principal)
  
  clienteId Int?     
  cliente   Cliente? @relation(fields: [clienteId], references: [id])

  itens      ItemVenda[]
  pagamentos Pagamento[] // <--- NOVO: Relação com pagamentos
  
  contaReceber ContaReceber?
  @@map("vendas")
}

model ItemVenda {
  id         Int     @id @default(autoincrement())
  quantidade Decimal @db.Decimal(10, 3)
  precoUnit  Decimal @map("preco_unitario") @db.Decimal(10, 2)
  vendaId    Int     @map("venda_id")
  produtoId  Int     @map("produto_id")
  produto    Produto @relation(fields: [produtoId], references: [id])
  venda      Venda   @relation(fields: [vendaId], references: [id])

  @@map("itens_venda")
}

// ... seus outros models (Produto, Venda, etc) ...

model Cliente {
  id        Int      @id @default(autoincrement())
  nome      String
  cpfCnpj   String?
  celular   String?
  endereco  String?
  criadoEm  DateTime @default(now())
  saldoHaver   Decimal @default(0) @db.Decimal(10, 2)
  saldoDevedor Decimal @default(0) @db.Decimal(10, 2)

  vendas    Venda[]
  contas    ContaReceber[] // <--- NOVO: Cliente tem contas a pagar
  orcamentos Orcamento[]
  @@map("clientes")
}

model User {
  id       String   @id @default(uuid())
  nome     String
  email    String   @unique
  senha    String
  cargo    String
  criadoEm DateTime @default(now())
}

model Produto {
  id          Int         @id @default(autoincrement())
  nome        String
  codigoBarra String?     @unique
  precoCusto  Float
  precoVenda  Float
  estoque     Int
  unidade     String?
  categoria   String?
  fornecedor  String?
  localizacao String?
  ipi         Float?      @default(0)
  icms        Float?      @default(0)
  frete       Float?      @default(0)
  ncm         String?
  cest        String?
  cfop        String?
  itens       ItemVenda[]
  itensOrcamento ItemOrcamento[]
}

// --- NOVO MODELO: CONTAS A RECEBER ---
model ContaReceber {
  id        Int      @id @default(autoincrement())
  valor     Decimal
  status    String   @default("PENDENTE") // PENDENTE ou PAGO
  data      DateTime @default(now())
  descricao       String?
  dataVencimento  DateTime
  
  clienteId Int
  cliente   Cliente  @relation(fields: [clienteId], references: [id])
  
  vendaId   Int      @unique
  venda     Venda    @relation(fields: [vendaId], references: [id])

  @@map("contas_receber")
}

// --- NOVO MODELO: PAGAMENTO ---
model Pagamento {
  id        Int      @id @default(autoincrement())
  valor     Decimal
  forma     String   // DINHEIRO, PIX, CARTAO, HAVER, A PRAZO
  
  vendaId   Int
  venda     Venda    @relation(fields: [vendaId], references: [id])

  @@map("pagamentos")
}

// --- NOVO: ORÇAMENTOS ---
model Orcamento {
  id        Int      @id @default(autoincrement())
  data      DateTime @default(now())
  total     Decimal
  
  clienteId Int?
  cliente   Cliente? @relation(fields: [clienteId], references: [id])

  itens     ItemOrcamento[]
  @@map("orcamentos")
}

model ItemOrcamento {
  id          Int       @id @default(autoincrement())
  quantidade  Decimal
  precoUnit   Decimal
  
  orcamentoId Int
  orcamento   Orcamento @relation(fields: [orcamentoId], references: [id], onDelete: Cascade)
  
  produtoId   Int
  produto     Produto   @relation(fields: [produtoId], references: [id])

  @@map("itens_orcamento")
}
// --- CONTROLE DE CAIXA ---

model Caixa {
  id            Int       @id @default(autoincrement())
  dataAbertura  DateTime  @default(now())
  dataFechamento DateTime? // Pode ser nulo se o caixa ainda estiver aberto
  saldoInicial  Decimal   @db.Decimal(10, 2)
  saldoAtual     Decimal   @default(0)
  saldoFinal    Decimal?  @db.Decimal(10, 2)
  status        String    @default("ABERTO") // "ABERTO" ou "FECHADO"
  observacoes   String?
  
  movimentacoes MovimentacaoCaixa[]
}

model MovimentacaoCaixa {
  id          Int      @id @default(autoincrement())
  data        DateTime @default(now())
  tipo        String   // "VENDA", "SANGRIA", "SUPRIMENTO", "ABERTURA"
  valor       Decimal  @db.Decimal(10, 2)
  descricao   String?
  
  caixa       Caixa    @relation(fields: [caixaId], references: [id])
  caixaId     Int
}