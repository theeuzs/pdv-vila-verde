generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Venda {
  id        Int      @id @default(autoincrement())
  data      DateTime @default(now())
  total     Decimal
  entrega         Boolean  @default(false)       // √â pra entregar?
  statusEntrega   String?  @default("PENDENTE")  // "PENDENTE" ou "ENTREGUE"
  enderecoEntrega String?                        // Onde entregar?
  
  // formaPagamento String? (Pode apagar ou deixar como opcional, n√£o vamos mais usar ele como principal)
  
  clienteId Int?     
  cliente   Cliente? @relation(fields: [clienteId], references: [id])

  itens      ItemVenda[]
  pagamentos Pagamento[] // <--- NOVO: Rela√ß√£o com pagamentos
  
  contaReceber ContaReceber?
  @@map("vendas")
}

model ItemVenda {
  id         Int     @id @default(autoincrement())
  quantidade Decimal @db.Decimal(10, 3)
  precoUnit  Decimal @map("preco_unitario") @db.Decimal(10, 2)
  vendaId    Int     @map("venda_id")
  produtoId  Int     @map("produto_id")
  produto    Produto @relation(fields: [produtoId], references: [id])
  venda      Venda   @relation(fields: [vendaId], references: [id])

  @@map("itens_venda")
}

// ... seus outros models (Produto, Venda, etc) ...

model Cliente {
  id           Int      @id @default(autoincrement())
  nome         String
  
  // üëá Seus dados de contato atuais
  cpfCnpj      String?  @unique // Importante ser √∫nico para n√£o duplicar cadastro
  celular      String?
  
  // üëá O Pulo do Gato para NF-e: Endere√ßo Separado
  // (Mantenha o 'endereco' antigo por seguran√ßa, mas comece a usar os novos)
  endereco     String?  // Seu campo antigo (pode deixar aqui)
  
  email        String?  // Para enviar a nota por email
  cep          String?
  rua          String?
  numero       String?
  bairro       String?
  cidade       String?
  estado       String?  // UF (Ex: PR, SP)

  // üëá Seus campos financeiros (MANTIDOS IGUAIS)
  saldoHaver   Decimal  @default(0) @db.Decimal(10, 2)
  saldoDevedor Decimal  @default(0) @db.Decimal(10, 2)
  
  criadoEm     DateTime @default(now())

  // üëá Suas Rela√ß√µes (MANTIDAS IGUAIS)
  vendas       Venda[]
  contas       ContaReceber[]
  orcamentos   Orcamento[]

  @@map("clientes")
}

model User {
  id       String   @id @default(uuid())
  nome     String
  email    String   @unique
  senha    String
  cargo    String
  criadoEm DateTime @default(now())
}

model Produto {
  id          Int      @id @default(autoincrement())
  nome        String
  codigoBarra String?  @unique
  
  // Seus pre√ßos atuais (Mantenha Float se j√° est√° usando assim)
  precoCusto  Float
  precoVenda  Float
  estoque     Int
  
  // Seus campos atuais
  unidade     String?  // Vamos usar esse campo para enviar como 'uCom' (UN, KG...)
  categoria   String?
  fornecedor  String?
  localizacao String?
  
  // Seus impostos (Pode manter, mas a API fiscal foca mais no NCM/CSOSN)
  ipi         Float?   @default(0)
  icms        Float?   @default(0)
  frete       Float?   @default(0)

  // üëá CAMPOS FISCAIS QUE VOC√ä J√Å TEM (MANTENHA) üëá
  ncm         String?  // Essencial! Ex: "22021000" (Refrigerante)
  cest        String?  
  cfop        String?  // Ex: "5102" (Venda)

  // üëá O QUE FALTA ADICIONAR AGORA üëá
  csosn       String   @default("102")  // 102 = Tributado pelo Simples Nacional
  origem      String   @default("0")    // 0 = Nacional
  
  itens       ItemVenda[]
  itensOrcamento ItemOrcamento[]
}

// --- NOVO MODELO: CONTAS A RECEBER ---
model ContaReceber {
  id        Int      @id @default(autoincrement())
  valor     Decimal
  status    String   @default("PENDENTE") // PENDENTE ou PAGO
  data      DateTime @default(now())
  descricao       String?
  dataVencimento  DateTime
  
  clienteId Int
  cliente   Cliente  @relation(fields: [clienteId], references: [id])
  
  vendaId   Int      @unique
  venda     Venda    @relation(fields: [vendaId], references: [id])

  @@map("contas_receber")
}

// --- NOVO MODELO: PAGAMENTO ---
model Pagamento {
  id        Int      @id @default(autoincrement())
  valor     Decimal
  forma     String   // DINHEIRO, PIX, CARTAO, HAVER, A PRAZO
  
  vendaId   Int
  venda     Venda    @relation(fields: [vendaId], references: [id])

  @@map("pagamentos")
}

// --- NOVO: OR√áAMENTOS ---
model Orcamento {
  id        Int      @id @default(autoincrement())
  data      DateTime @default(now())
  total     Decimal
  
  clienteId Int?
  cliente   Cliente? @relation(fields: [clienteId], references: [id])

  itens     ItemOrcamento[]
  @@map("orcamentos")
}

model ItemOrcamento {
  id          Int       @id @default(autoincrement())
  quantidade  Decimal
  precoUnit   Decimal
  
  orcamentoId Int
  orcamento   Orcamento @relation(fields: [orcamentoId], references: [id], onDelete: Cascade)
  
  produtoId   Int
  produto     Produto   @relation(fields: [produtoId], references: [id])

  @@map("itens_orcamento")
}
// --- CONTROLE DE CAIXA ---

model Caixa {
  id            Int       @id @default(autoincrement())
  dataAbertura  DateTime  @default(now())
  dataFechamento DateTime? // Pode ser nulo se o caixa ainda estiver aberto
  saldoInicial  Decimal   @db.Decimal(10, 2)
  saldoAtual     Decimal   @default(0)
  saldoFinal    Decimal?  @db.Decimal(10, 2)
  status        String    @default("ABERTO") // "ABERTO" ou "FECHADO"
  observacoes   String?
  
  movimentacoes MovimentacaoCaixa[]
}

model MovimentacaoCaixa {
  id          Int      @id @default(autoincrement())
  data        DateTime @default(now())
  tipo        String   // "VENDA", "SANGRIA", "SUPRIMENTO", "ABERTURA"
  valor       Decimal  @db.Decimal(10, 2)
  descricao   String?
  
  caixa       Caixa    @relation(fields: [caixaId], references: [id])
  caixaId     Int
}