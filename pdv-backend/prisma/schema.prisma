generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Venda {
  id              Int           @id @default(autoincrement())
  data            DateTime      @default(now())
  total           Decimal       @db.Decimal(10, 2)
  entrega         Boolean       @default(false)
  pagamento       String?
  urlFiscal       String?
  statusEntrega   String?       @default("PENDENTE")
  enderecoEntrega String?
  nota_emitida    Boolean       @default(false)
  nota_id_nuvem   String?
  nota_chave      String?
  nota_numero     Int?
  nota_url_pdf    String?
  nota_cancelada  Boolean       @default(false)
  clienteId       Int?
  caixaId         Int?
  contaReceber    ContaReceber?
  itens           ItemVenda[]
  pagamentos      Pagamento[]
  caixa           Caixa?        @relation(fields: [caixaId], references: [id])
  cliente         Cliente?      @relation(fields: [clienteId], references: [id])
  usuarioId       String?     // O "?" deixa opcional para nÃ£o quebrar vendas antigas
  usuario         User? @relation(fields: [usuarioId], references: [id])

  @@map("vendas")
}

model ItemVenda {
  id         Int     @id @default(autoincrement())
  quantidade Decimal @db.Decimal(10, 3)
  precoUnit  Decimal @map("preco_unitario") @db.Decimal(10, 2)
  vendaId    Int     @map("venda_id")
  produtoId  Int     @map("produto_id")
  produto    Produto @relation(fields: [produtoId], references: [id])
  venda      Venda   @relation(fields: [vendaId], references: [id])

  @@map("itens_venda")
}

model Pagamento {
  id      Int     @id @default(autoincrement())
  forma   String
  valor   Decimal @db.Decimal(10, 2)
  vendaId Int
  venda   Venda   @relation(fields: [vendaId], references: [id])

  @@map("pagamentos")
}

model Produto {
  id             Int             @id @default(autoincrement())
  nome           String
  codigoBarra    String?         @map("codigo_barra")
  precoVenda     Decimal         @map("preco_venda") @db.Decimal(10, 2)
  precoCusto     Decimal?        @map("preco_custo") @db.Decimal(10, 2)
  estoque        Decimal         @default(0) @db.Decimal(10, 3)
  unidade        String          @default("UN")
  categoria      String?
  ativo          Boolean         @default(true)
  
  // ðŸ‘‡ CAMPOS NOVOS ADICIONADOS AQUI ðŸ‘‡
  fornecedorId Int?
  fornecedor   Fornecedor? @relation(fields: [fornecedorId], references: [id])
  localizacao    String?
  ncm            String?
  cest           String?
  cfop           String?         @default("5102")
  csosn          String?         @default("102")
  origem         String?         @default("0")
  ipi            Decimal?        @default(0) @db.Decimal(10, 2)
  icms           Decimal?        @default(0) @db.Decimal(10, 2)
  frete          Decimal?        @default(0) @db.Decimal(10, 2)

  itensOrcamento ItemOrcamento[]
  itensVenda     ItemVenda[]

  @@map("produtos")
}

model User {
  id       String   @id @default(uuid())
  nome     String
  username String   @unique
  email    String   @unique
  senha    String
  cargo    String
  criadoEm DateTime @default(now())
  caixas   Caixa[]
  vendas   Venda[]

  @@map("users")
}

model Cliente {
  id            Int            @id @default(autoincrement())
  nome          String
  cpfCnpj       String?        @map("cpf_cnpj")
  celular       String?
  endereco      String?
  endereco2     String?
  endereco3     String?
  saldoHaver    Decimal        @default(0) @map("saldo_haver") @db.Decimal(10, 2)
  contasReceber ContaReceber[]
  orcamentos    Orcamento[]
  vendas        Venda[]

  @@map("clientes")
}

model Orcamento {
  id        Int             @id @default(autoincrement())
  data      DateTime        @default(now())
  total     Decimal         @db.Decimal(10, 2)
  status    String          @default("PENDENTE")
  clienteId Int?
  itens     ItemOrcamento[]
  cliente   Cliente?        @relation(fields: [clienteId], references: [id])

  @@map("orcamentos")
}

model ItemOrcamento {
  id          Int       @id @default(autoincrement())
  quantidade  Decimal   @db.Decimal(10, 3)
  precoUnit   Decimal   @map("preco_unitario") @db.Decimal(10, 2)
  orcamentoId Int       @map("orcamento_id")
  produtoId   Int       @map("produto_id")
  orcamento   Orcamento @relation(fields: [orcamentoId], references: [id])
  produto     Produto   @relation(fields: [produtoId], references: [id])

  @@map("itens_orcamento")
}

model ContaReceber {
  id            Int       @id @default(autoincrement())
  valor         Decimal   @db.Decimal(10, 2)
  valorPago     Decimal   @default(0) @map("valor_pago") @db.Decimal(10, 2)
  vencimento    DateTime
  status        String    @default("PENDENTE")
  descricao     String?
  dataCriacao   DateTime  @default(now()) @map("data_criacao")
  dataPagamento DateTime? @map("data_pagamento")
  clienteId     Int
  vendaId       Int?      @unique @map("venda_id")
  cliente       Cliente   @relation(fields: [clienteId], references: [id])
  venda         Venda?    @relation(fields: [vendaId], references: [id])

  @@map("contas_receber")
}

model Entrega {
  id          Int       @id @default(autoincrement())
  vendaId     Int       @unique @map("venda_id")
  clienteNome String    @map("cliente_nome")
  endereco    String
  telefone    String?
  status      String    @default("PENDENTE")
  dataCriacao DateTime  @default(now()) @map("data_criacao")
  dataEntrega DateTime? @map("data_entrega")
  observacoes String?

  @@map("entregas")
}

model Caixa {
  id             Int                 @id @default(autoincrement())
  dataAbertura   DateTime            @default(now())
  dataFechamento DateTime?
  saldoInicial   Decimal             @db.Decimal(10, 2)
  saldoAtual     Decimal             @default(0) @db.Decimal(10, 2)
  saldoFinal     Decimal?            @db.Decimal(10, 2)
  status         String              @default("ABERTO")
  observacoes    String?
  usuarioId      String?             @map("usuario_id")
  user           User?               @relation(fields: [usuarioId], references: [id])
  movimentacoes  MovimentacaoCaixa[]
  vendas         Venda[]

  @@index([usuarioId])
  @@index([status])
  @@map("caixas")
}

model MovimentacaoCaixa {
  id        Int      @id @default(autoincrement())
  data      DateTime @default(now())
  tipo      String
  valor     Decimal  @db.Decimal(10, 2)
  descricao String?
  caixaId   Int
  caixa     Caixa    @relation(fields: [caixaId], references: [id])
  formaPagamento String?

  @@map("movimentacoes_caixa")
}

// Cole isso no final do arquivo schema.prisma
model Fornecedor {
  id        Int       @id @default(autoincrement())
  nome      String
  contato   String?
  produtos  Produto[] // Isso avisa que um fornecedor tem vÃ¡rios produtos
}
